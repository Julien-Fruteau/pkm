{"pageProps":{"note":{"id":"KboSDNpIShkOlDCJuWvZa","title":"Web","desc":"","updated":1654269769170,"created":1631921386219,"custom":{},"fname":"python.web","type":"note","vault":{"fsPath":"vault"},"contentHash":"df37e38917b5f9b872f06d168b0fc331","links":[{"from":{"fname":"python","vaultName":"vault"},"type":"backlink","position":{"start":{"line":5,"column":1,"offset":26},"end":{"line":5,"column":15,"offset":40},"indent":[]},"value":"python.web","alias":"python.web"}],"anchors":{"api-request-limit":{"type":"header","text":"API Request Limit","value":"api-request-limit","line":8,"column":0,"depth":2}},"children":[],"parent":"ENDcCZFjAW9h66eDoFg7I","data":{}},"body":"<h1 id=\"web\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#web\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Web</h1>\n<h2 id=\"api-request-limit\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#api-request-limit\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>API Request Limit</h2>\n<p>Context : #<a href=\"\">python</a> #<a href=\"\">api</a> #<a href=\"\">rate-limit</a> #<a href=\"\">aiohttp</a> #<a href=\"\">asyncio</a> #<a href=\"\">asyncio_throttle</a></p>\n<p>A usage example of the <code>asyncio_throttle</code> module that can be useful to overcome api rate limit</p>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> asyncio\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">from</span> asyncio_throttle<span class=\"token punctuation\">.</span>throttler <span class=\"token keyword\">import</span> Throttler\n\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">wait_s</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> throttler<span class=\"token punctuation\">:</span> Throttler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">async</span> <span class=\"token keyword\">with</span> throttler<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># ! make an http request here instead :) !</span>\n        <span class=\"token keyword\">await</span> asyncio<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span></span><span class=\"token string\"> done\"</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">tasks</span><span class=\"token punctuation\">(</span>throttler<span class=\"token punctuation\">:</span> Throttler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    t <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>asyncio<span class=\"token punctuation\">.</span>create_task<span class=\"token punctuation\">(</span>wait_s<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> throttler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">await</span> asyncio<span class=\"token punctuation\">.</span>wait<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">,</span> timeout<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> return_when<span class=\"token operator\">=</span>asyncio<span class=\"token punctuation\">.</span>ALL_COMPLETED<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># for a rate limit of 5 requests / sec :</span>\n    t <span class=\"token operator\">=</span> Throttler<span class=\"token punctuation\">(</span>rate_limit<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> period<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">await</span> tasks<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    asyncio<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> \n</code></pre>\n<hr>\n<strong>Backlinks</strong>\n<ul>\n<li><a href=\"/pkm/notes/ENDcCZFjAW9h66eDoFg7I\">Python</a></li>\n</ul>","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Root","desc":"","updated":1654269246697,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"95c106dfdcb097574cc5e3b9ac850f05","links":[],"anchors":{"welcome-to-the-knowledge-management-website":{"type":"header","text":"Welcome to the knowledge management website","value":"welcome-to-the-knowledge-management-website","line":7,"column":0,"depth":2}},"children":["ENDcCZFjAW9h66eDoFg7I"],"parent":null,"data":{},"body":"## Welcome to the knowledge management website\n\nLast updated:\n- version: v0.83\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.83.0","enableEditorDecorations":true,"enableHandlebarTemplates":false,"enableFullHierarchyNoteTitle":false,"templateHierarchy":"template","seeds":{"dendron.templates":{},"dendron.handbook":{"site":{"url":"https://handbook.dendron.so","index":"handbook"}}}},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://julien-fruteau.github.io","assetsPrefix":"/pkm","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"writeStubs":false,"seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enablePrettyLinks":true,"enableTaskNotes":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}